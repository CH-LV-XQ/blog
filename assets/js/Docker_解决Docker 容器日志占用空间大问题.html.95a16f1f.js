"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9863],{6262:(i,s)=>{s.A=(i,s)=>{const e=i.__vccOpts||i;for(const[i,a]of s)e[i]=a;return e}},4739:(i,s,e)=>{e.r(s),e.d(s,{comp:()=>n,data:()=>t});var a=e(641);const l={},n=(0,e(6262).A)(l,[["render",function(i,s){return(0,a.uX)(),(0,a.CE)("div",null,s[0]||(s[0]=[(0,a.Fv)('<h1 id="解决docker-容器日志占用空间大问题" tabindex="-1"><a class="header-anchor" href="#解决docker-容器日志占用空间大问题"><span>解决Docker 容器日志占用空间大问题</span></a></h1><h2 id="查看-docker-数据目录-镜像、容器存储位置" tabindex="-1"><a class="header-anchor" href="#查看-docker-数据目录-镜像、容器存储位置"><span>查看 Docker 数据目录（镜像、容器存储位置）</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Docker Root Dir&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 输出示例</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Dir:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="步骤一-快速定位哪个容器导致日志暴涨" tabindex="-1"><a class="header-anchor" href="#步骤一-快速定位哪个容器导致日志暴涨"><span>步骤一：快速定位哪个容器导致日志暴涨</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">container-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或者直接在容器目录查看文件夹占用大小</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 根据输出的文件夹占用大小定位容器</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">du</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者查看日志路径对应的容器：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inspect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">container-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--format</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;{{.Name}} - {{.LogPath}}&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="步骤二-查看日志内容-可省略不看内容" tabindex="-1"><a class="header-anchor" href="#步骤二-查看日志内容-可省略不看内容"><span>步骤二：查看日志内容(可省略不看内容)</span></a></h2><p>不要直接 cat，否则会把终端撑爆。使用 tail 查看最后的内容：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker 日志默认位置，根据自身环境设置目录</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/docker/containers/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">container-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">container-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">-json.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="步骤三-立即清空日志-释放磁盘空间" tabindex="-1"><a class="header-anchor" href="#步骤三-立即清空日志-释放磁盘空间"><span>步骤三：立即清空日志（释放磁盘空间）</span></a></h2><p>这是临时措施，不会重启容器：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; /var/lib/docker/containers/&lt;container-id&gt;/&lt;container-id&gt;-json.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>注意：这是将文件内容置空，文件仍存在但大小变为 0。</p><h2 id="步骤四-配置日志轮转-防止再次暴涨" tabindex="-1"><a class="header-anchor" href="#步骤四-配置日志轮转-防止再次暴涨"><span>步骤四：配置日志轮转，防止再次暴涨</span></a></h2><p>修改你的 docker-compose.yml 或运行参数，加入日志限制配置：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  milvus-standalone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">milvusdb/milvus:v2.5.6</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    logging</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      driver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;json-file&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      options</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        max-size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;100m&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        max-file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;5&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li>每个日志文件最大 100MB</li><li>最多保留 5 个轮转文件</li><li>日志总量最多 500MB</li></ul><h2 id="步骤五-重启容器使配置生效" tabindex="-1"><a class="header-anchor" href="#步骤五-重启容器使配置生效"><span>步骤五：重启容器使配置生效</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker-compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker-compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>或手动重启指定容器：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">container-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="最佳实践建议" tabindex="-1"><a class="header-anchor" href="#最佳实践建议"><span>最佳实践建议</span></a></h2><table><thead><tr><th>操作</th><th>推荐</th></tr></thead><tbody><tr><td>生产环境日志</td><td>启用 max-size + max-file</td></tr><tr><td>更高级管理</td><td>日志集中管理（ELK / Loki / FluentBit）</td></tr><tr><td>调试级别</td><td>避免无脑开启 debug 模式</td></tr><tr><td>定期巡检</td><td>du -sh /var/lib/docker/containers/<em>/</em>.log</td></tr></tbody></table><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>Docker 的 json-file 日志驱动默认<strong>无大小限制</strong>，在长时间运行服务时非常危险。我们可以：</p><ul><li>临时清空日志释放空间</li><li>长期设置轮转策略限制日志增长</li><li>结合日志监控工具提升运维能力</li></ul><p>避免磁盘“爆仓”，从这一刻开始优化你的 Docker 容器日志策略！</p>',29)]))}]]),t=JSON.parse('{"path":"/Docker/%E8%A7%A3%E5%86%B3Docker%20%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4%E5%A4%A7%E9%97%AE%E9%A2%98.html","title":"解决Docker 容器日志占用空间大问题","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2025-05-21T00:00:00.000Z","category":["Docker"],"tag":["Docker"],"description":"解决Docker 容器日志占用空间大问题 查看 Docker 数据目录（镜像、容器存储位置） 步骤一：快速定位哪个容器导致日志暴涨 或者查看日志路径对应的容器： 步骤二：查看日志内容(可省略不看内容) 不要直接 cat，否则会把终端撑爆。使用 tail 查看最后的内容： 步骤三：立即清空日志（释放磁盘空间） 这是临时措施，不会重启容器： 注意：这是将文...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/Docker/%E8%A7%A3%E5%86%B3Docker%20%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4%E5%A4%A7%E9%97%AE%E9%A2%98.html"}],["meta",{"property":"og:title","content":"解决Docker 容器日志占用空间大问题"}],["meta",{"property":"og:description","content":"解决Docker 容器日志占用空间大问题 查看 Docker 数据目录（镜像、容器存储位置） 步骤一：快速定位哪个容器导致日志暴涨 或者查看日志路径对应的容器： 步骤二：查看日志内容(可省略不看内容) 不要直接 cat，否则会把终端撑爆。使用 tail 查看最后的内容： 步骤三：立即清空日志（释放磁盘空间） 这是临时措施，不会重启容器： 注意：这是将文..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-17T09:41:05.000Z"}],["meta",{"property":"article:tag","content":"Docker"}],["meta",{"property":"article:published_time","content":"2025-05-21T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-17T09:41:05.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"解决Docker 容器日志占用空间大问题\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-05-21T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-17T09:41:05.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"查看 Docker 数据目录（镜像、容器存储位置）","slug":"查看-docker-数据目录-镜像、容器存储位置","link":"#查看-docker-数据目录-镜像、容器存储位置","children":[]},{"level":2,"title":"步骤一：快速定位哪个容器导致日志暴涨","slug":"步骤一-快速定位哪个容器导致日志暴涨","link":"#步骤一-快速定位哪个容器导致日志暴涨","children":[]},{"level":2,"title":"步骤二：查看日志内容(可省略不看内容)","slug":"步骤二-查看日志内容-可省略不看内容","link":"#步骤二-查看日志内容-可省略不看内容","children":[]},{"level":2,"title":"步骤三：立即清空日志（释放磁盘空间）","slug":"步骤三-立即清空日志-释放磁盘空间","link":"#步骤三-立即清空日志-释放磁盘空间","children":[]},{"level":2,"title":"步骤四：配置日志轮转，防止再次暴涨","slug":"步骤四-配置日志轮转-防止再次暴涨","link":"#步骤四-配置日志轮转-防止再次暴涨","children":[]},{"level":2,"title":"步骤五：重启容器使配置生效","slug":"步骤五-重启容器使配置生效","link":"#步骤五-重启容器使配置生效","children":[]},{"level":2,"title":"最佳实践建议","slug":"最佳实践建议","link":"#最佳实践建议","children":[]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1747795735000,"updatedTime":1750153265000,"contributors":[{"name":"ch","email":"ch825523424@163.com","commits":2}]},"readingTime":{"minutes":1.77,"words":530},"filePathRelative":"Docker/解决Docker 容器日志占用空间大问题.md","localizedDate":"2025年5月21日","excerpt":"\\n<h2>查看 Docker 数据目录（镜像、容器存储位置）</h2>\\n<div class=\\"language-shell line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"shell\\" data-title=\\"shell\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">docker</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> info</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\"> | </span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">grep</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> \\"Docker Root Dir\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 输出示例</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Docker</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Root</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Dir:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> /var/lib/docker</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);